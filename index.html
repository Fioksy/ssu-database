<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>SSU PDA v4.0 - FIELD UNIT</title>
    <style>
        :root {
            --pda-silver: #d4d4d4;
            --pda-dark-silver: #a0a0a0;
            --pda-screen-bg: #f0f0f0;
            --win-blue: #005a9e;
            --win-dark: #333;
            --sys-font: 'Tahoma', 'Segoe UI', sans-serif;
            --bios-font: 'Courier New', monospace;
        }

        body { 
            background-color: #1a1a1a; 
            font-family: var(--sys-font); 
            margin: 0; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            height: 100vh; 
            overflow: hidden;
        }

        /* PDA Handheld Chassis */
        .pda-chassis {
            width: 480px;
            height: 800px;
            background: linear-gradient(145deg, #e6e6e6, #999);
            border: 4px solid #444;
            border-radius: 40px;
            padding: 20px;
            box-shadow: 0 50px 100px rgba(0,0,0,0.8);
            display: flex;
            flex-direction: column;
            position: relative;
        }

        /* The Internal Screen */
        .pda-screen {
            flex-grow: 1;
            background: var(--pda-screen-bg);
            border: 10px solid #222;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
        }

        /* Portrait Title Bar */
        .title-bar {
            background: var(--win-blue);
            color: white;
            padding: 8px 12px;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 14px;
        }

        /* Content Area optimized for Portrait */
        .viewport {
            flex-grow: 1;
            overflow-y: auto;
            background: white;
            margin: 5px;
            border: 2px solid var(--pda-dark-silver);
        }

        table { width: 100%; border-collapse: collapse; display: none; }
        table.active { display: table; }
        th { 
            background: #e1e1e1; 
            border-bottom: 2px solid var(--win-dark); 
            padding: 8px; 
            font-size: 11px; 
            text-align: left;
            position: sticky; top: 0;
        }
        td { border-bottom: 1px solid #ddd; height: 40px; }
        input { width: 100%; height: 100%; border: none; padding: 5px; font-size: 13px; }

        /* PDA Tab Navigation (Icons/Buttons) */
        .pda-nav {
            display: flex;
            background: #ddd;
            border-top: 2px solid #999;
            padding: 5px;
            gap: 2px;
        }
        .nav-btn {
            flex: 1;
            background: #ccc;
            border: 1px solid #777;
            padding: 10px 2px;
            font-size: 10px;
            font-weight: bold;
            cursor: pointer;
            text-align: center;
        }
        .nav-btn.active { background: white; border-bottom: none; }

        /* Hardware Buttons at bottom */
        .hw-buttons {
            display: flex;
            justify-content: space-around;
            padding-top: 15px;
        }
        .hw-btn {
            width: 60px; height: 35px;
            background: #777;
            border-radius: 10px;
            border: 2px solid #444;
            box-shadow: inset 2px 2px 5px #999;
        }

        /* Status Bar with Buffer Animation */
        .status-footer {
            background: #eee;
            padding: 4px 10px;
            font-size: 11px;
            border-top: 1px solid #ccc;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .buffering {
            display: inline-block;
            width: 10px; height: 10px;
            border: 2px solid #999;
            border-top: 2px solid var(--win-blue);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 5px;
        }
        @keyframes spin { 100% { transform: rotate(360deg); } }

        /* Updated BIOS */
        #boot-screen { 
            position: absolute; top:0; left:0; width:100%; height:100%; 
            background: #000; color: #fff; font-family: var(--bios-font); 
            padding: 20px; z-index: 1000; box-sizing: border-box; 
        }
        .progress-box { width: 100%; border: 1px solid #fff; height: 15px; margin-top: 20px; }
        #progress-bar { width: 0%; background: #fff; height: 100%; }

        /* Transmission Overlay */
        #uplink-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255,255,255,0.8);
            display: none; flex-direction: column; justify-content: center; align-items: center; z-index: 500;
        }
    </style>
</head>
<body>

<div class="pda-chassis">
    <div class="pda-screen">
        <div id="boot-screen">
            <div id="boot-log" style="font-size: 12px;"></div>
            <div class="progress-box"><div id="progress-bar"></div></div>
        </div>

        <div id="uplink-overlay">
            <div class="buffering" style="width:30px; height:30px; border-width:4px;"></div>
            <p><b>SYNCING DATA...</b></p>
        </div>

        <div class="title-bar">
            <span>SSU_PDA_v4.0</span>
            <span id="pda-clock">00:00</span>
        </div>

        <div class="pda-nav">
            <div class="nav-btn active" id="btn-Personnel" onclick="switchTab('Personnel')">PERSONNEL</div>
            <div class="nav-btn" id="btn-Stalkers" onclick="switchTab('Stalkers')">WATCHLIST</div>
            <div class="nav-btn" id="btn-Relations" onclick="switchTab('Relations')">RELATIONS</div>
        </div>

        <div class="viewport">
            <table id="table-Personnel" class="active"><thead><tr><th>CALLSIGN</th><th>RANK</th><th>SPEC</th></tr></thead><tbody></tbody></table>
            <table id="table-Stalkers"><thead><tr><th>ALIAS</th><th>THREAT</th><th>LOC</th></tr></thead><tbody></tbody></table>
            <table id="table-Relations"><thead><tr><th>FACTION</th><th>STATUS</th><th>ROE</th></tr></thead><tbody></tbody></table>
        </div>

        <div style="padding: 10px; background: #ddd; display: flex; gap: 10px;">
            <button onclick="addNewRow()" style="flex:1; padding:8px;">+ NEW ENTRY</button>
            <button onclick="saveToCloud()" style="flex:1; padding:8px; background:var(--win-blue); color:white; border:none;">COMMIT</button>
        </div>

        <div class="status-footer">
            <div><span id="buffer-icon" class="buffering" style="display:none;"></span>STATUS: <span id="sync-status">IDLE</span></div>
            <div>BATT: 88%</div>
        </div>
    </div>

    <div class="hw-buttons">
        <div class="hw-btn"></div>
        <div class="hw-btn" style="width:80px; height:45px; border-radius: 50%;"></div>
        <div class="hw-btn"></div>
    </div>
</div>

<script>
    const UPLINK_URL = "https://script.google.com/macros/s/AKfycbyqfwn91pnhsTSG2mlPIG1X9OSpPwnnk_ur3JtpOMtxzwVR1I4iR4jFwxEgSj2Xg_VR/exec";
    let currentTab = "Personnel";

    async function switchTab(tabName) {
        currentTab = tabName;
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        document.getElementById('btn-' + tabName).classList.add('active');
        document.querySelectorAll('table').forEach(t => t.classList.remove('active'));
        document.getElementById('table-' + tabName).classList.add('active');
        await loadFromCloud();
    }

    async function loadFromCloud() {
        document.getElementById('sync-status').innerText = "DOWNLOADING";
        document.getElementById('buffer-icon').style.display = 'inline-block';
        try {
            const response = await fetch(`${UPLINK_URL}?sheet=${currentTab}`);
            const data = await response.json();
            const body = document.querySelector(`#table-${currentTab} tbody`);
            body.innerHTML = "";
            data.forEach(rowData => renderRow(rowData));
            document.getElementById('sync-status').innerText = "CONNECTED";
        } catch (e) { document.getElementById('sync-status').innerText = "OFFLINE"; }
        document.getElementById('buffer-icon').style.display = 'none';
    }

    async function saveToCloud() {
        document.getElementById('uplink-overlay').style.display = 'flex';
        const rows = Array.from(document.querySelectorAll(`#table-${currentTab} tbody tr`)).map(tr => {
            return Array.from(tr.querySelectorAll('input')).map(input => input.value);
        });

        try {
            await fetch(UPLINK_URL, {
                method: "POST", mode: "no-cors",
                body: JSON.stringify({ targetSheet: currentTab, rows: rows })
            });
            setTimeout(() => {
                document.getElementById('uplink-overlay').style.display = 'none';
                loadFromCloud();
            }, 1000);
        } catch (e) { 
            document.getElementById('uplink-overlay').style.display = 'none';
        }
    }

    function renderRow(rowData = null) {
        const body = document.querySelector(`#table-${currentTab} tbody`);
        const tr = document.createElement('tr');
        const colCount = document.querySelectorAll(`#table-${currentTab} th`).length;
        const data = rowData || new Array(colCount).fill("");
        data.forEach(val => {
            const td = document.createElement('td');
            td.innerHTML = `<input type="text" value="${val}">`;
            tr.appendChild(td);
        });
        body.appendChild(tr);
    }

    function addNewRow() { renderRow(); }

    // BIOS Script with White Loading Bar
    const logLines = ["PDA BOOT v4.0", "KERNEL LOADED", "UPLINK MODULE: OK", "SYNCING RTC...", "LOGGING IN..."];
    let l = 0;
    function runBoot() {
        const log = document.getElementById('boot-log');
        if(l < logLines.length) {
            log.innerHTML += "> " + logLines[l] + "<br>";
            l++; setTimeout(runBoot, 300);
        } else {
            let p = 0;
            const bar = document.getElementById('progress-bar');
            const int = setInterval(() => {
                p += 5; bar.style.width = p + "%";
                if(p >= 100) {
                    clearInterval(int);
                    loadFromCloud().then(() => document.getElementById('boot-screen').style.display='none');
                }
            }, 50);
        }
    }
    window.onload = runBoot;
    setInterval(() => {
        const now = new Date();
        document.getElementById('pda-clock').innerText = now.getHours().toString().padStart(2, '0') + ":" + now.getMinutes().toString().padStart(2, '0');
    }, 1000);
</script>
</body>
</html>