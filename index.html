<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>SSU PDA v2.5 - SECURE UPLINK</title>
    <style>
        :root { 
            --win-gray: #C0C0C0; 
            --win-dark: #808080; 
            --win-light: #FFFFFF; 
            --win-shadow: #404040; 
            --win-blue: #000080; 
            --sys-font: 'Tahoma', sans-serif; 
        }

        body { background-color: #008080; font-family: var(--sys-font); margin: 0; display: flex; justify-content: center; align-items: center; height: 100vh; font-size: 12px; overflow: hidden; }

        /* The Case */
        .os-window { width: 950px; height: 650px; background: var(--win-gray); border: 2px solid; border-color: var(--win-light) var(--win-shadow) var(--win-shadow) var(--win-light); display: flex; flex-direction: column; box-shadow: 4px 4px 20px rgba(0,0,0,0.6); position: relative; }
        
        /* Title Bar */
        .title-bar { background: linear-gradient(90deg, var(--win-blue), #1084d0); color: white; padding: 4px 8px; font-weight: bold; display: flex; justify-content: space-between; align-items: center; }
        .title-controls span { background: var(--win-gray); color: black; padding: 1px 5px; margin-left: 2px; border: 1px solid white; font-size: 10px; cursor: default; box-shadow: 1px 1px 0px black; }

        /* Navigation */
        .toolbar { padding: 6px; border-bottom: 1px solid var(--win-dark); display: flex; gap: 5px; background: var(--win-gray); box-shadow: inset 0 -1px 0 #eee; }
        .win-btn { background: var(--win-gray); border: 2px solid; border-color: var(--win-light) var(--win-dark) var(--win-dark) var(--win-light); padding: 4px 12px; cursor: pointer; font-size: 11px; font-family: var(--sys-font); }
        .win-btn:active, .win-btn.active { border-color: var(--win-dark) var(--win-light) var(--win-light) var(--win-dark); background: #dcdcdc; }
        .save-btn { font-weight: bold; background: #c5e1c5; margin-left: auto; border-color: #ffffff #555 #555 #ffffff; }

        /* Main Display Area */
        .content-area { flex-grow: 1; margin: 10px; background: white; border: 2px solid inset; border-color: var(--win-dark) var(--win-light) var(--win-light) var(--win-dark); overflow-y: auto; }
        table { width: 100%; border-collapse: collapse; }
        th { background: var(--win-gray); border: 1px solid var(--win-dark); padding: 6px; text-align: left; position: sticky; top: 0; z-index: 10; font-size: 11px; }
        td { border: 1px solid #ddd; height: 30px; }
        input { width: 100%; height: 100%; border: none; padding: 8px; box-sizing: border-box; font-family: var(--sys-font); font-size: 12px; background: transparent; }
        input:focus { background: #ffffcc; outline: none; }

        /* Boot Screen */
        #boot-screen { position: absolute; top:0; left:0; width:100%; height:100%; background: black; color: #33ff33; font-family: 'Courier New', monospace; padding: 30px; z-index: 2000; box-sizing: border-box; }
        
        /* Status Bar */
        .status-bar { background: var(--win-gray); padding: 3px 10px; border-top: 1px solid var(--win-dark); font-size: 11px; display: flex; justify-content: space-between; }
        .sync-pulse { color: #008000; font-weight: bold; animation: blink 1.5s infinite; }
        @keyframes blink { 0% { opacity: 1; } 50% { opacity: 0.3; } 100% { opacity: 1; } }
    </style>
</head>
<body>

<div id="boot-screen">
    <div id="boot-log"></div>
</div>

<div class="os-window">
    <div class="title-bar">
        <span>SSU_REMOTE_ACCESS_V2.5.exe - [SECTOR: AGROPROM]</span>
        <div class="title-controls"><span>_</span><span>[ ]</span><span>X</span></div>
    </div>

    <div class="toolbar">
        <button class="win-btn active" id="btn-Personnel" onclick="switchTab('Personnel')">PERSONNEL</button>
        <button class="win-btn" id="btn-Stalkers" onclick="switchTab('Stalkers')">STALKER_WATCHLIST</button>
        <button class="win-btn" id="btn-Relations" onclick="switchTab('Relations')">FACTION_ROE</button>
        <button class="win-btn" onclick="addNewRow()">+ ADD ENTRY</button>
        <button class="win-btn save-btn" id="save-btn" onclick="saveToCloud()">ðŸ’¾ COMMIT CHANGES</button>
    </div>

    <div class="content-area">
        <table id="main-table">
            <thead id="table-head">
                </thead>
            <tbody id="table-body">
                </tbody>
        </table>
    </div>

    <div class="status-bar">
        <span>USER: ENLISTED_ADMIN</span>
        <span id="sync-status">UPLINK: IDLE</span>
        <span id="clock">00:00:00</span>
    </div>
</div>

<script>
    // --- INTEGRATED UPLINK CONFIG ---
    const UPLINK_URL = "https://script.google.com/macros/s/AKfycbyqfwn91pnhsTSG2mlPIG1X9OSpPwnnk_ur3JtpOMtxzwVR1I4iR4jFwxEgSj2Xg_VR/exec";
    
    let currentTab = "Personnel";
    const headers = {
        "Personnel": ["Callsign", "Rank", "Specialization", "Status"],
        "Stalkers": ["Alias", "Threat Level", "Last Location", "Directives"],
        "Relations": ["Faction Name", "Diplomatic Status", "ROE"]
    };

    // --- LOGIC ---

    async function switchTab(tabName) {
        currentTab = tabName;
        // UI Update
        document.querySelectorAll('.win-btn').forEach(b => b.classList.remove('active'));
        document.getElementById('btn-' + tabName).classList.add('active');
        
        // Update Headers
        const head = document.getElementById('table-head');
        head.innerHTML = `<tr>${headers[tabName].map(h => `<th>${h}</th>`).join('')}</tr>`;
        
        // Fetch Data
        await loadFromCloud();
    }

    async function loadFromCloud() {
        updateStatus("DOWNLOADING...", true);
        try {
            const response = await fetch(`${UPLINK_URL}?sheet=${currentTab}`);
            const data = await response.json();
            const body = document.getElementById('table-body');
            body.innerHTML = "";
            data.forEach(rowData => renderRow(rowData));
            updateStatus("CONNECTED");
        } catch (e) {
            updateStatus("UPLINK ERROR");
            console.error(e);
        }
    }

    async function saveToCloud() {
        const btn = document.getElementById('save-btn');
        btn.disabled = true;
        updateStatus("UPLOADING...", true);
        
        const rows = Array.from(document.querySelectorAll('#table-body tr')).map(tr => {
            return Array.from(tr.querySelectorAll('input')).map(input => input.value);
        });

        const payload = {
            targetSheet: currentTab,
            rows: rows
        };

        try {
            await fetch(UPLINK_URL, {
                method: "POST",
                mode: "no-cors",
                body: JSON.stringify(payload)
            });
            updateStatus("SUCCESS");
            setTimeout(loadFromCloud, 1000); 
        } catch (e) {
            updateStatus("ERROR");
        }
        btn.disabled = false;
    }

    function renderRow(rowData = null) {
        const body = document.getElementById('table-body');
        const tr = document.createElement('tr');
        const colCount = headers[currentTab].length;
        const data = rowData || new Array(colCount).fill("");

        data.forEach(val => {
            const td = document.createElement('td');
            td.innerHTML = `<input type="text" value="${val}" placeholder="...">`;
            tr.appendChild(td);
        });
        body.appendChild(tr);
    }

    function addNewRow() { renderRow(); }

    function updateStatus(txt, pulse = false) {
        const el = document.getElementById('sync-status');
        el.innerText = "UPLINK: " + txt;
        el.className = pulse ? "sync-pulse" : "";
    }

    // --- BOOT SEQUENCE ---
    const logLines = [
        "SSU RUGGED TERMINAL BIOS v2.05",
        "ESTABLISHING SATELLITE HANDSHAKE...",
        "ENCRYPTION KEY: ********** ACCEPTED",
        "SYNCING WITH AGROPROM MAINFRAME...",
        "REMOTE ACCESS GRANTED."
    ];

    let l = 0;
    function runBoot() {
        if(l < logLines.length) {
            document.getElementById('boot-log').innerHTML += `> ${logLines[l]}<br>`;
            l++; setTimeout(runBoot, 500);
        } else {
            switchTab('Personnel').then(() => {
                setTimeout(() => document.getElementById('boot-screen').style.display='none', 800);
            });
        }
    }

    window.onload = runBoot;
    setInterval(() => document.getElementById('clock').innerText = new Date().toLocaleTimeString(), 1000);
</script>
</body>
</html>