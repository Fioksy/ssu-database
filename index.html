<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>SSU-TACTICAL-UPLINK-v3.6</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Courier+Prime:wght@400;700&display=swap');

        :root {
            --win-gray: #c0c0c0;
            --win-dark: #808080;
            --win-light: #ffffff;
            --win-shadow: #404040;
            --win-blue: #000080; /* Classic Win95 Blue */
            --military-bg: #2b2e2b;
            --sys-font: 'Tahoma', 'Segoe UI', sans-serif;
            --bios-font: 'Courier Prime', monospace;
        }

        body { 
            background-color: var(--military-bg); 
            font-family: var(--sys-font); 
            margin: 0; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            height: 100vh; 
            overflow: hidden;
        }

        /* Rugged Frame */
        .pda-shell {
            width: 960px;
            height: 660px;
            background: #3d3d3d;
            padding: 15px;
            border: 4px solid #1a1a1a;
            border-radius: 8px;
            box-shadow: 0 30px 60px rgba(0,0,0,0.9);
            position: relative;
        }

        /* Classic Windows Window */
        .os-window {
            height: 100%;
            background: var(--win-gray);
            border: 2px solid;
            border-color: var(--win-light) var(--win-shadow) var(--win-shadow) var(--win-light);
            display: flex;
            flex-direction: column;
        }

        /* Win95 Title Bar */
        .title-bar {
            background: linear-gradient(90deg, var(--win-blue), #1084d0);
            color: white;
            padding: 3px 6px;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 13px;
        }

        .title-controls span {
            background: var(--win-gray);
            color: black;
            border: 1px solid;
            border-color: var(--win-light) var(--win-shadow) var(--win-shadow) var(--win-light);
            padding: 0 4px;
            margin-left: 2px;
            font-size: 10px;
            cursor: default;
        }

        /* Navigation */
        .toolbar { padding: 6px; border-bottom: 1px solid var(--win-dark); display: flex; gap: 4px; background: var(--win-gray); }
        
        .win-btn { 
            background: var(--win-gray); 
            border: 2px solid; 
            border-color: var(--win-light) var(--win-dark) var(--win-dark) var(--win-light); 
            padding: 4px 10px; 
            cursor: pointer; 
            font-size: 11px;
            font-family: var(--sys-font);
        }
        
        .win-btn:active, .win-btn.active { 
            border-color: var(--win-dark) var(--win-light) var(--win-light) var(--win-dark); 
            padding: 5px 9px 3px 11px;
            outline: none;
        }

        .save-btn { margin-left: auto; font-weight: bold; }

        /* Content Area */
        .content-area { 
            flex-grow: 1; 
            margin: 8px; 
            background: white; 
            border: 2px solid inset; 
            border-color: var(--win-dark) var(--win-light) var(--win-light) var(--win-dark); 
            overflow-y: auto; 
        }

        table { width: 100%; border-collapse: collapse; display: none; }
        table.active { display: table; }
        th { background: var(--win-gray); border: 1px solid var(--win-dark); padding: 6px; text-align: left; font-size: 11px; position: sticky; top: 0; }
        td { border: 1px solid #dcdcdc; height: 28px; }
        input { width: 100%; height: 100%; border: none; padding: 6px; box-sizing: border-box; font-size: 12px; font-family: var(--sys-font); background: transparent; }
        input:focus { background: #ffffcc; outline: none; }

        /* BIOS BOOT SCREEN */
        #boot-screen { 
            position: absolute; top:0; left:0; width:100%; height:100%; 
            background: #000; color: #fff; font-family: var(--bios-font); 
            padding: 40px; z-index: 9999; box-sizing: border-box; 
        }
        
        #progress-container { width: 100%; border: 1px solid #fff; height: 20px; margin-top: 20px; display: none; }
        #progress-bar { width: 0%; background: #fff; height: 100%; transition: width 0.1s; }

        /* UPLINK OVERLAY (Flashy but readable) */
        #uplink-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.7);
            color: #fff; display: none; flex-direction: column;
            justify-content: center; align-items: center; z-index: 5000;
        }
        .uplink-box {
            background: var(--win-gray); border: 2px solid #fff;
            padding: 20px; text-align: center; color: black;
            box-shadow: 10px 10px 0px rgba(0,0,0,0.5);
        }

        .status-bar { background: var(--win-gray); border-top: 1px solid var(--win-dark); padding: 2px 8px; font-size: 11px; display: flex; justify-content: space-between; }
    </style>
</head>
<body>

<div class="pda-shell">
    <div id="boot-screen">
        <div id="boot-log"></div>
        <div id="progress-container">
            <div id="progress-bar"></div>
        </div>
    </div>

    <div id="uplink-overlay">
        <div class="uplink-box">
            <div style="font-weight: bold; margin-bottom: 10px;">BURST TRANSMISSION IN PROGRESS</div>
            <div id="uplink-text" style="font-family: monospace;">ENCRYPTING...</div>
        </div>
    </div>

    <div class="os-window">
        <div class="title-bar">
            <span>SSU_REMOTE_TERMINAL.exe</span>
            <div class="title-controls"><span>?</span><span>Ã—</span></div>
        </div>

        <div class="toolbar">
            <button class="win-btn active" id="btn-Personnel" onclick="switchTab('Personnel')">Personnel</button>
            <button class="win-btn" id="btn-Stalkers" onclick="switchTab('Stalkers')">Watchlist</button>
            <button class="win-btn" id="btn-Relations" onclick="switchTab('Relations')">Relations</button>
            <button class="win-btn" onclick="addNewRow()">Add Row</button>
            <button class="win-btn save-btn" id="save-btn" onclick="saveToCloud()">COMMIT CHANGES</button>
        </div>

        <div class="content-area">
            <table id="table-Personnel" class="active"><thead><tr><th>Callsign</th><th>Rank</th><th>Spec</th><th>Status</th></tr></thead><tbody></tbody></table>
            <table id="table-Stalkers"><thead><tr><th>Alias</th><th>Threat</th><th>Location</th><th>Directives</th></tr></thead><tbody></tbody></table>
            <table id="table-Relations"><thead><tr><th>Faction</th><th>Standing</th><th>ROE</th></tr></thead><tbody></tbody></table>
        </div>

        <div class="status-bar">
            <span id="sync-status">UPLINK: READY</span>
            <span id="clock">00:00:00</span>
        </div>
    </div>
</div>

<script>
    const UPLINK_URL = "https://script.google.com/macros/s/AKfycbyqfwn91pnhsTSG2mlPIG1X9OSpPwnnk_ur3JtpOMtxzwVR1I4iR4jFwxEgSj2Xg_VR/exec";
    let currentTab = "Personnel";

    async function switchTab(tabName) {
        currentTab = tabName;
        document.querySelectorAll('.win-btn').forEach(b => b.classList.remove('active'));
        document.getElementById('btn-' + tabName).classList.add('active');
        document.querySelectorAll('table').forEach(t => t.classList.remove('active'));
        document.getElementById('table-' + tabName).classList.add('active');
        await loadFromCloud();
    }

    async function loadFromCloud() {
        document.getElementById('sync-status').innerText = "UPLINK: RECEIVING...";
        try {
            const response = await fetch(`${UPLINK_URL}?sheet=${currentTab}`);
            const data = await response.json();
            const body = document.querySelector(`#table-${currentTab} tbody`);
            body.innerHTML = "";
            data.forEach(rowData => renderRow(rowData));
            document.getElementById('sync-status').innerText = "UPLINK: CONNECTED";
        } catch (e) { document.getElementById('sync-status').innerText = "UPLINK: ERROR"; }
    }

    async function saveToCloud() {
        document.getElementById('uplink-overlay').style.display = 'flex';
        const rows = Array.from(document.querySelectorAll(`#table-${currentTab} tbody tr`)).map(tr => {
            return Array.from(tr.querySelectorAll('input')).map(input => input.value);
        });

        try {
            document.getElementById('uplink-text').innerText = "ESTABLISHING LINK...";
            await fetch(UPLINK_URL, {
                method: "POST", mode: "no-cors",
                body: JSON.stringify({ targetSheet: currentTab, rows: rows })
            });
            document.getElementById('uplink-text').innerText = "TRANSMISSION SUCCESSFUL";
            setTimeout(() => {
                document.getElementById('uplink-overlay').style.display = 'none';
                loadFromCloud();
            }, 1200);
        } catch (e) { 
            document.getElementById('uplink-text').innerText = "LINK FAILED";
            setTimeout(() => document.getElementById('uplink-overlay').style.display = 'none', 2000);
        }
    }

    function renderRow(rowData = null) {
        const body = document.querySelector(`#table-${currentTab} tbody`);
        const tr = document.createElement('tr');
        const colCount = document.querySelectorAll(`#table-${currentTab} th`).length;
        const data = rowData || new Array(colCount).fill("");
        data.forEach(val => {
            const td = document.createElement('td');
            td.innerHTML = `<input type="text" value="${val}">`;
            tr.appendChild(td);
        });
        body.appendChild(tr);
    }

    function addNewRow() { renderRow(); }

    // BIOS Script
    const logLines = [
        "SSU TACTICAL BOOTLOADER v3.6", "SYSTEM CHECK: OK", "VRAM: 64MB OK",
        "UPLINK MODULE: DETECTED", "AUTHENTICATING SSU_KEY...", "INIT: REMOTE_DATA_LOAD"
    ];
    let l = 0;
    function runBoot() {
        const log = document.getElementById('boot-log');
        if(l < logLines.length) {
            log.innerHTML += logLines[l] + "<br>";
            l++; setTimeout(runBoot, 300);
        } else {
            document.getElementById('progress-container').style.display = 'block';
            let p = 0;
            const bar = document.getElementById('progress-bar');
            const int = setInterval(() => {
                p += 10; bar.style.width = p + "%";
                if(p >= 100) {
                    clearInterval(int);
                    loadFromCloud().then(() => document.getElementById('boot-screen').style.display='none');
                }
            }, 80);
        }
    }
    window.onload = runBoot;
    setInterval(() => document.getElementById('clock').innerText = new Date().toLocaleTimeString(), 1000);
</script>
</body>
</html>