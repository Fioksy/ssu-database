<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>SSU PDA v3.0 - SECURE UPLINK</title>
    <style>
        :root { --win-gray: #C0C0C0; --win-dark: #808080; --win-light: #FFFFFF; --win-shadow: #404040; --win-blue: #000080; --sys-font: 'Tahoma', sans-serif; }
        body { background-color: #008080; font-family: var(--sys-font); margin: 0; display: flex; justify-content: center; align-items: center; height: 100vh; font-size: 12px; overflow: hidden; }
        .os-window { width: 950px; height: 650px; background: var(--win-gray); border: 2px solid; border-color: var(--win-light) var(--win-shadow) var(--win-shadow) var(--win-light); display: flex; flex-direction: column; box-shadow: 4px 4px 20px rgba(0,0,0,0.6); position: relative; }
        .title-bar { background: linear-gradient(90deg, var(--win-blue), #1084d0); color: white; padding: 4px 8px; font-weight: bold; display: flex; justify-content: space-between; align-items: center; }
        .toolbar { padding: 6px; border-bottom: 1px solid var(--win-dark); display: flex; gap: 5px; background: var(--win-gray); }
        .win-btn { background: var(--win-gray); border: 2px solid; border-color: var(--win-light) var(--win-dark) var(--win-dark) var(--win-light); padding: 4px 12px; cursor: pointer; font-size: 11px; }
        .win-btn:active, .win-btn.active { border-color: var(--win-dark) var(--win-light) var(--win-light) var(--win-dark); background: #dcdcdc; }
        .save-btn { font-weight: bold; background: #c5e1c5; margin-left: auto; }
        .content-area { flex-grow: 1; margin: 10px; background: white; border: 2px solid inset; border-color: var(--win-dark) var(--win-light) var(--win-light) var(--win-dark); overflow-y: auto; }
        table { width: 100%; border-collapse: collapse; display: none; }
        table.active { display: table; }
        th { background: var(--win-gray); border: 1px solid var(--win-dark); padding: 6px; text-align: left; position: sticky; top: 0; z-index: 10; }
        td { border: 1px solid #ddd; height: 30px; }
        input { width: 100%; height: 100%; border: none; padding: 8px; box-sizing: border-box; font-family: var(--sys-font); font-size: 12px; background: transparent; }
        input:focus { background: #ffffcc; outline: none; }
        #boot-screen { position: absolute; top:0; left:0; width:100%; height:100%; background: black; color: #33ff33; font-family: monospace; padding: 30px; z-index: 2000; }
        .status-bar { background: var(--win-gray); padding: 3px 10px; border-top: 1px solid var(--win-dark); font-size: 11px; display: flex; justify-content: space-between; }
    </style>
</head>
<body>

<div id="boot-screen"><div id="boot-log"></div></div>

<div class="os-window">
    <div class="title-bar"><span>SSU_REMOTE_ACCESS_V3.0.exe</span><div>[X]</div></div>
    <div class="toolbar">
        <button class="win-btn active" id="btn-Personnel" onclick="switchTab('Personnel')">PERSONNEL</button>
        <button class="win-btn" id="btn-Stalkers" onclick="switchTab('Stalkers')">WATCHLIST</button>
        <button class="win-btn" id="btn-Relations" onclick="switchTab('Relations')">RELATIONS</button>
        <button class="win-btn" onclick="addNewRow()">+ ADD ENTRY</button>
        <button class="win-btn save-btn" id="save-btn" onclick="saveToCloud()">ðŸ’¾ COMMIT CHANGES</button>
    </div>
    <div class="content-area">
        <table id="table-Personnel" class="active"><thead><tr><th>Callsign</th><th>Rank</th><th>Spec</th><th>Status</th></tr></thead><tbody></tbody></table>
        <table id="table-Stalkers"><thead><tr><th>Alias</th><th>Threat</th><th>Location</th><th>Directives</th></tr></thead><tbody></tbody></table>
        <table id="table-Relations"><thead><tr><th>Faction</th><th>Standing</th><th>ROE</th></tr></thead><tbody></tbody></table>
    </div>
    <div class="status-bar">
        <span id="sync-status">UPLINK: IDLE</span>
        <span id="clock">00:00:00</span>
    </div>
</div>

<script>
    // PASTE YOUR NEW WEB APP URL HERE
    const UPLINK_URL = "https://script.google.com/macros/s/AKfycbyqfwn91pnhsTSG2mlPIG1X9OSpPwnnk_ur3JtpOMtxzwVR1I4iR4jFwxEgSj2Xg_VR/exec";
    
    let currentTab = "Personnel";

    async function switchTab(tabName) {
        currentTab = tabName;
        document.querySelectorAll('.win-btn').forEach(b => b.classList.remove('active'));
        document.getElementById('btn-' + tabName).classList.add('active');
        document.querySelectorAll('table').forEach(t => t.classList.remove('active'));
        document.getElementById('table-' + tabName).classList.add('active');
        await loadFromCloud();
    }

    async function loadFromCloud() {
        updateStatus("SYNCING...");
        try {
            const response = await fetch(`${UPLINK_URL}?sheet=${currentTab}`);
            const data = await response.json();
            const body = document.querySelector(`#table-${currentTab} tbody`);
            body.innerHTML = "";
            data.forEach(rowData => renderRow(rowData));
            updateStatus("CONNECTED");
        } catch (e) {
            updateStatus("UPLINK ERROR - Check Script URL");
        }
    }

    async function saveToCloud() {
        const btn = document.getElementById('save-btn');
        btn.disabled = true;
        updateStatus("UPLOADING...");
        const rows = Array.from(document.querySelectorAll(`#table-${currentTab} tbody tr`)).map(tr => {
            return Array.from(tr.querySelectorAll('input')).map(input => input.value);
        });
        try {
            await fetch(UPLINK_URL, {
                method: "POST",
                mode: "no-cors",
                body: JSON.stringify({ targetSheet: currentTab, rows: rows })
            });
            updateStatus("SUCCESS");
            setTimeout(loadFromCloud, 1000); 
        } catch (e) { updateStatus("SAVE ERROR"); }
        btn.disabled = false;
    }

    function renderRow(rowData = null) {
        const body = document.querySelector(`#table-${currentTab} tbody`);
        const tr = document.createElement('tr');
        const colCount = document.querySelectorAll(`#table-${currentTab} th`).length;
        const data = rowData || new Array(colCount).fill("");
        data.forEach(val => {
            const td = document.createElement('td');
            td.innerHTML = `<input type="text" value="${val}">`;
            tr.appendChild(td);
        });
        body.appendChild(tr);
    }

    function addNewRow() { renderRow(); }
    function updateStatus(txt) { document.getElementById('sync-status').innerText = "UPLINK: " + txt; }

    const logLines = ["INITIALIZING HANDSHAKE...", "BYPASSING FIREWALL...", "ACCESSING SSU MAIN CORE...", "READY."];
    let l = 0;
    function runBoot() {
        if(l < logLines.length) {
            document.getElementById('boot-log').innerHTML += `> ${logLines[l]}<br>`;
            l++; setTimeout(runBoot, 400);
        } else {
            loadFromCloud().then(() => document.getElementById('boot-screen').style.display='none');
        }
    }
    window.onload = runBoot;
    setInterval(() => document.getElementById('clock').innerText = new Date().toLocaleTimeString(), 1000);
</script>
</body>
</html>